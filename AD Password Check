# Import Active Directory module (if not already loaded)
Import-Module ActiveDirectory

# Define the path to the text file containing email addresses
$EmailListPath = "C:\path\to\email_list.txt"

# Check if file exists
if (!(Test-Path $EmailListPath)) {
    Write-Host "Error: File not found at $EmailListPath" -ForegroundColor Red
    exit
}

# Read email addresses from the file
$Emails = Get-Content -Path $EmailListPath

# Loop through each email and check password age
foreach ($Email in $Emails) {
    # Trim whitespace
    $Email = $Email.Trim()

    # Get user details from Active Directory
    $User = Get-ADUser -Filter {EmailAddress -eq $Email} -Properties PasswordLastSet

    if ($User) {
        # Calculate password age
        $PasswordLastSet = $User.PasswordLastSet
        $PasswordAge = (Get-Date) - $PasswordLastSet
        $PasswordAgeDays = [math]::Round($PasswordAge.TotalDays, 0)

        # Display the result
        Write-Host "User: $Email | Password Age: $PasswordAgeDays days" -ForegroundColor Green
    } else {
        Write-Host "User not found: $Email" -ForegroundColor Yellow
    }
}